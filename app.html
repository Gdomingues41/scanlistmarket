<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scanlist Market</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    /* ... seu CSS existente ... */
    body { font-family: Arial, sans-serif; margin: 0; padding: 0 16px; background-color: #fff; }
    /* ... */
    .cart-item button { background: none; border: none; color: red; font-size: 20px; cursor: pointer; }
    
    /* NOVO CSS PARA OS BOT√ïES DE A√á√ÉO DO PRODUTO */
    .product-name-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px; /* Espa√ßo entre o nome e os bot√µes */
    }
    .product-actions button {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        padding: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="produto-info" style="display:none; text-align: center;">
      <img id="produto-imagem" class="product-img" src="" alt="Imagem do Produto">
      
      <div class="product-name-container">
          <input id="produto-nome" type="text" class="input-field" placeholder="Nome do produto" style="flex-grow: 1;"/>
          <div id="product-actions-wrapper" class="product-actions" style="display: none;">
              <button onclick="editarProduto()" title="Editar/Corrigir nome">‚úèÔ∏è</button>
              <button onclick="reportarErro()" title="Reportar erro">üö©</button>
          </div>
      </div>
      <input id="preco-unitario" type="number" class="input-field" placeholder="Pre√ßo unit√°rio">
      <button class="btn" onclick="adicionarAoCarrinho()">‚ûï Adicionar ao Carrinho</button>
    </div>
    </div>

  <script type="module">
    // MUDAN√áA: Importando mais ferramentas do Firestore
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getFirestore, doc, updateDoc, serverTimestamp, collection, addDoc, query, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    // ... sua firebaseConfig com a apiKey ...
    
    // --- SCRIPT PRINCIPAL ---
    let cart = [];
    let barcodeAtual = null; // NOVA VARI√ÅVEL GLOBAL para guardar o c√≥digo de barras do produto em tela

    // --- FUN√á√ïES DO APP ---
    
    // FUN√á√ÉO "buscarProduto" ATUALIZADA
    window.buscarProduto = function() {
      const code = document.getElementById("codigoBarra").value.trim();
      if (!code) return alert("Digite um c√≥digo de barras v√°lido.");
      
      barcodeAtual = code; // Guarda o c√≥digo de barras atual

      fetch(`https://world.openfoodfacts.org/api/v0/product/${code}.json`)
        .then(res => res.json())
        .then(data => {
          if (data.status === 1 && data.product) {
            // ... (c√≥digo para preencher os campos) ...
            document.getElementById("product-actions-wrapper").style.display = "flex"; // Mostra os bot√µes de a√ß√£o
          } else { 
            window.iniciarCadastroManual();
            document.getElementById("product-actions-wrapper").style.display = "none"; // Esconde os bot√µes no cadastro manual
          }
        })
        .catch(err => {
          // ... (c√≥digo do catch) ...
        });
    };

    // NOVA FUN√á√ÉO para reportar um erro
    window.reportarErro = async function() {
        if (!barcodeAtual) {
            return alert("Nenhum produto selecionado para reportar.");
        }
        if (!confirm("Tem certeza que deseja reportar um erro neste produto? Isso o marcar√° para revis√£o.")) {
            return;
        }

        try {
            // Como ainda n√£o temos um banco de dados p√∫blico, vamos apenas simular o alerta
            // No futuro, aqui iria o c√≥digo para atualizar o produto no Firestore
            // Ex: const productRef = doc(db, "produtos", barcodeAtual);
            //     await updateDoc(productRef, { reportado: true });
            alert(`Produto ${barcodeAtual} reportado com sucesso! Obrigado pela ajuda.`);
        } catch (e) {
            console.error("Erro ao reportar: ", e);
            alert("N√£o foi poss√≠vel reportar o erro.");
        }
    };

    // NOVA FUN√á√ÉO (placeholder) para editar
    window.editarProduto = function() {
        alert("Funcionalidade de editar em desenvolvimento! O pr√≥ximo passo.");
    };

    // ... cole aqui TODAS as suas outras fun√ß√µes completas (adicionarAoCarrinho, etc.)
    // ...
    
  </script>
</body>
</html>